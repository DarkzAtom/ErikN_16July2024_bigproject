import firestore_file
import firebase_admin



proxieslist_dbupload = """45.196.61.158:6196:ramxcgif:vk9ai0q1t67y
192.53.67.106:5655:ramxcgif:vk9ai0q1t67y
107.180.191.250:6943:ramxcgif:vk9ai0q1t67y
192.46.188.106:5765:ramxcgif:vk9ai0q1t67y
216.98.249.138:7119:ramxcgif:vk9ai0q1t67y
154.194.24.217:5827:ramxcgif:vk9ai0q1t67y
192.145.71.4:6641:ramxcgif:vk9ai0q1t67y
45.196.52.107:6122:ramxcgif:vk9ai0q1t67y
154.194.24.144:5754:ramxcgif:vk9ai0q1t67y
5.59.250.31:6729:ramxcgif:vk9ai0q1t67y
62.164.231.149:9461:ramxcgif:vk9ai0q1t67y
199.187.189.104:6895:ramxcgif:vk9ai0q1t67y
63.141.62.115:6408:ramxcgif:vk9ai0q1t67y
45.196.33.11:5992:ramxcgif:vk9ai0q1t67y
45.196.54.203:6782:ramxcgif:vk9ai0q1t67y
62.164.225.233:7546:ramxcgif:vk9ai0q1t67y
63.246.130.91:6292:ramxcgif:vk9ai0q1t67y
5.59.250.208:6906:ramxcgif:vk9ai0q1t67y
185.253.122.117:5926:ramxcgif:vk9ai0q1t67y
45.115.60.199:5928:ramxcgif:vk9ai0q1t67y"""

tiktok_accounts_list_dbupload_old = """tonaro52:155ny&pahozuc:lapajarata8608@rambler.ru:XQU0Mk5*0+M((jr^*5
topgamer.6839s:qU@ZUcOVYtam61:downconfnugneho405@rambler.ru:p&LnkfOU6nc^3Vdl)1
topgamer_853:9x#asyhEn:midykarenor9909@rambler.ru:LMAv2L+TE^JnjkvwA4
tort.67:xoR!EPOVyXYTo7^09:erwiwanito6206@rambler.ru:NUCCqtT8RotxkfX297
tort26jz:vABI#hirO%V226:detogpoportna8694@rambler.ru:kX*KZBanRx4h_wPwM8
tortburton63:pysuhilocelez^u4:boltticocheapbsor1380@rambler.ru:nT-^*kgK8jSq*lRzh0
torthardner:Ta%FiLyX5:rebobbtipaddmoons4385@rambler.ru:QUiskV9$B-)APgoB86
tortrunewall1:868!1@rymu:lisinbuzzhosvo351@rambler.ru:z3xbcHgLe7g+fp*PY2
tot.481:606VOMEV*AHAGOC:sluragophmagdest2578@rambler.ru:DTkDUg*w0k7WMtudV0
tot58klatton:HuTERU3@67:enorferefvo6198@rambler.ru:D)PA$)F9zc*7a1lyx5
tot8368:fyv%ynocakuxom829:alcestadeslu6910@rambler.ru:*HUh0bWSPEYKs8ycD6
totmictikfid6:lawiped!a17:cattnantaiprerti2182@rambler.ru:hXme))lM_9PoZ*7RQ5
toybonnie.70:lebaguf%e15:kingdicontubang8418@rambler.ru:s2puNvp@jPSEaMupB4
toybonnie171:Fazepyl*et655:liemalamito2325@rambler.ru:nXkZKb+(@i-TBs&z53
toybonnie193:H!OxyKeWAwuVAZeh4:stabexphotaske5055@rambler.ru:$BFXwd8$8-ziiI6!c2
toybonnie511:55lYXere@qAQAlYn:fildiemacote9170@rambler.ru:$Nq37A@iERlONpe&63
toybonnie5u:mex$atycelu658:godownsponalbal3221@rambler.ru:pcK&8yHkJ*oL06G1j3
toybonnie795:F@aqahipezuko1:kireajumpfunpea4563@rambler.ru:3@Eb8hw&2Ro^AC6Rz8
toybonnie934:bunaj@ud935:corktegunpoball6005@rambler.ru:cXqfGtoA9VE16ILT*8
toybonniesmalldoll:jezo&ni641:handvonakoli4762@rambler.ru:@3J!)P*p24zssRi7$9
tractor_goose:KyKY%SucutAh96:conbomokava5731@rambler.ru:A88Z$dNuYbFCgjye^9
tractor_hans:hefyf*ury7:nedapageti8380@rambler.ru:XbNYtuiiZlM)U@mhj3
tragedi767:1&paciwacodi:wirohkicentde8684@rambler.ru:nPq46J4(oOg5s7^hS5
tragedienne847:76p&ANawuxu:blogrosgaimaxmcop680@rambler.ru:NsmmOr0GybhzsUp6I6
tragedienne926:rESALIQ46#1:theohranabseca294@rambler.ru:At)bRiQ0)9M9Q4!Z_8"""

tiktok_accounts_list_dbupload = """ruthmitchellsusan_7925:y73m99nL@t#M / user8618735611405:h63z2012aA@u#Y / karenperezbetty_7643:h97u2012aB@c#C / nancyrodriguezsarah_8411:d73l100tP@r#O / lauranelsondonna_9711:p50k100iI@n#K / user3277463515379:c84i2012iI@r#O / donnahillbetty_5041:k42q2000aH@q#U / michellepereznancy_0033:w70b100dE@p#H / karenscotthelen_9255:r26e9vI@n#E / jenniferwrightbetty_6329:w01v99wM@o#O / user7524181953611:n51u9nE@k#Z / ruthmillerhelen_2065:p10f99yS@l#A / lauraadamselizabeth_1804:b95u2011dN@k#P / mariagonzalezlinda_1394:s63s2011tE@a#U / elizabethyoungruth_6063:r86z2010lI@t#U / donnalopezdonna_8399:d03z100mI@l#Y / ruthlewismichelle_8374:k08f100kU@i#B / susanwilsonsharon_8481:v12p9uB@s#L / mariaturnerbetty_2956:o90l99dA@y#Z / ruthallenmichelle_8886:r37k2011oU@i#O / kimberlyparkerbetty_8388:h56e100iE@o#Y / margaretwalkerlinda_6790:g29p2000cW@n#B / donnagarciabetty_1124:w14t2012aL@q#T / mariaallenjennifer_7233:o44o2010hL@a#P / mariabrownhelen_2492:n58m99dA@c#U / maryleemary_7210:s28l100dT@u#O / dorothyjacksonsarah_8928:x15d2010oY@c#X / nancybrownjennifer_5721:u04r2011iU@x#U / maryhilllisa_9109:g60j2012gE@j#E / deborahrobertslinda_9316:i73m2012jU@w#I / susankingmaria_4759:t33v100uD@n#V / sharonhillnancy_5265:t04e2012iM@y#P / helendavisdorothy_5506:b52o2000wG@i#F / lisacollinssharon_4418:e89v9oA@i#I / patriciaharrislinda_8227:j33u2000eE@n#I / lisathomasmaria_7748:p16p2000eA@q#Q / sandracollinssusan_2571:o74g100uN@u#E / user86156181500982:o68z2010vI@d#U / laurataylordonna_1103:j23j99fZ@q#F / helenkingdeborah_0620:g71v100oO@p#A / helenkingmichelle_4949:i07h2012aZ@c#O / caroldavismary_2323:t46u100uK@y#A / helensmithsusan_7085:n38q2011aC@x#B / sandraturnersandra_7628:f49f2011jK@b#U / bettymillerdorothy_7791:r30l99xB@z#V / helenhallruth_2186:s41s2010xH@l#E / lisahallbarbara_7517:r79w2000kU@l#K
"""


def add_document_with_set_method(db, collection_name, data_list):
    for i, data in enumerate(data_list):
        doc_id = str(i+1).zfill(5)
        db.collection(collection_name).document(doc_id).set(data)
        print(f"Collection {collection_name}: Added document with ID: {doc_id}")


db = firestore_file.firestore_init()

proxlistdb_refined = []
ttaccslistdb_refined = []


def upload_proxy_list_to_db():
    proxlistdb_unrefined = proxieslist_dbupload.split("\n")
    for proxy in proxlistdb_unrefined:
        proxyaddr, proxyport, proxylogin, proxypswd = proxy.split(":")
        dict_to_append = {
            "proxyaddr": proxyaddr,
            "proxyport": proxyport,
            "proxylogin": proxylogin,
            "proxypswd": proxypswd
        }
        proxlistdb_refined.append(dict_to_append)
    add_document_with_set_method(db, "proxieslist", proxlistdb_refined)


def upload_tiktok_accounts_list_to_db():
    ttaccslistdb_unrefined = tiktok_accounts_list_dbupload.split("/")
    for ttacc in ttaccslistdb_unrefined:
        ttacc.strip()
        login, pswd = ttacc.split(":")
        email = 'absent'
        restcred = 'absent'
        dict_to_append = {
            "ttlogin": login.strip(),
            "ttpswd": pswd.strip(),
            "ttemail": email,
            "ttrestcred": restcred
        }
        ttaccslistdb_refined.append(dict_to_append)
    add_document_with_set_method(db, "tiktok_accounts_list", ttaccslistdb_refined)


def upload_inuse_status():
    db = firestore_file.firestore_init()
    elements_list_outof_ttaccslist = tiktok_accounts_list_dbupload.split('/')
    elements_list_outof_proxylist = proxieslist_dbupload.split('\n')
    ttaccs_col_ref = db.collection('inuse').document('tiktok_inuse_status')
    prox_col_ref = db.collection('inuse').document('proxy_inuse_status')
    update_ttaccs_dict = {}
    update_proxies_dict = {}
    for i in range(0, len(elements_list_outof_ttaccslist)):
        key = f'{str(i+1).zfill(5)}.inuse'
        update_ttaccs_dict[key] = False
    for i in range(0, len(elements_list_outof_proxylist)):
        key = f"{str(i+1).zfill(5)}.inuse"
        update_proxies_dict[key] = {
            '1': False,
            '2': False,
            '3': False,
            '4': False,
            '5': False
        }
    try:
        ttaccs_col_ref.update(update_ttaccs_dict)
        print('Successfully updated the inuse statuses of TT accs!')
        prox_col_ref.update(update_proxies_dict)
        print('Successfully updated the inuse statuses of proxies!')
    except Exception as e:
        print(f"Haven't succeeded in updating the inuse statuses, e: {e}")

def clear_inuse_docs():
    ttaccs_ref = db.collection('inuse').document('tiktok_inuse_status')
    prox_ref = db.collection('inuse').document('proxy_inuse_status')
    ttaccs_ref.set({})
    prox_ref.set({})


def set_deviceuptodatecache_false():
    db = firestore_file.firestore_init()
    docs_ref = db.collection('devices_registry').stream()
    for doc in docs_ref:
        doc_ref = db.collection('devices_registry').document(doc.id)
        doc_ref.update({
            'up_to_date': False
        })

def main():
    upload_proxy_list_to_db()
    upload_tiktok_accounts_list_to_db()
    clear_inuse_docs()
    upload_inuse_status()
    set_deviceuptodatecache_false()


main()

